<!doctype html>
<html><head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<title>Gpio - QSWTECK</title>
<link href="./style.css" rel="stylesheet" type="text/css" />
<script src="./zepto.js"></script>
<script src="./user.js"></script> 
</head>

<body>
<div id="page_hd">
Gpio设置
<div id="page_sel">[&equiv;]</div>
</div>

<div class="guide_line">
本页用以设置物联模块的硬件IO引脚的功能。<span onClick="$('#help').removeClass('hidden')">[点击展开]</span><br>
	<div id="help" class="hidden"><br>
	【按键输入】将IO接到上拉型按键，固件内部会做软件防抖，按键松开则影响变量值<br>
	【信号输入】IO作为信号输入，IO输入值影响变量值<br>
	【信号输出】变量具体BIT位的值，会直接输出到IO口<br>
	【开漏输出】同输出一样，开漏模式<br>
	<br>
	注：PIN16不支持输入中断，所以关闭了输入功能，只支持输出。
	</div>
</div>

<div class="tip_line" id="web_tip" style="display:none"></div>

<form action="./gpio.set" method="post">
<div class="config_line">
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="config_table">
<tr>
  <th></th>
  <td>类型</td>
  <td>电阻</td>
</tr>

<tr class="config_tr"><th>Pin0</th>
<td>
  <select class="config_sel" disabled>
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>
  </select>
</td>
<td>
  <select class="config_sel" disabled>
    <option value="0">无</option>
    <option value="1">上拉</option>
  </select>
</td>
</tr>

<tr class="config_tr"><th>Pin1</th>
<td>
  <select class="config_sel">
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>
  </select>
</td>
<td>
  <select class="config_sel">
    <option value="0">无</option>
    <option value="1">上拉</option>
  </select>
</td>
</tr>

<tr class="config_tr"><th>Pin4</th>
<td>
  <select class="config_sel">
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>
      <option value="6">PWM</option>
  </select>
</td>
<td>
  <select class="config_sel">
    <option value="0">无</option>
    <option value="1">上拉</option>
  </select>
</td>
</tr>

<tr class="config_tr"><th>Pin5</th>
<td>
  <select class="config_sel">
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>
      <option value="6">PWM</option>
  </select>
</td>
<td>
  <select class="config_sel">
    <option value="0">无</option>
    <option value="1">上拉</option>
  </select>
</td>
</tr>

<tr class="config_tr">
  <th>Pin12</th>
<td>
  <select class="config_sel has_oled">
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>
      <option value="8">OLED SDA</option>
  </select>
</td>
<td>
  <select class="config_sel">
    <option value="0">无</option>
    <option value="1">上拉</option>
  </select>
</td>
</tr>

<tr class="config_tr">
  <th>Pin13</th>
<td>
  <select class="config_sel has_uart">
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>
      <option value="7">UART-RX</option>
  </select>
</td>
<td>
  <select class="config_sel">
    <option value="0">无</option>
    <option value="1">上拉</option>
  </select>
</td>
</tr>

<tr class="config_tr">
  <th>Pin14</th>
<td>
  <select class="config_sel has_oled">
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>      
      <option value="8">OLED SCL</option>
  </select>
</td>
<td>
  <select class="config_sel">
    <option value="0">无</option>
    <option value="1">上拉</option>
  </select>
</td>
</tr>

<tr class="config_tr">
  <th>Pin15</th>
<td>
  <select class="config_sel has_uart">
  		<option value="0">----</option>
      <option value="1">按键输入</option>
      <option value="2">信号输入</option>
      <option value="3">信号输出</option>
      <option value="4">开漏输出</option>
      <option value="7">UART-TX</option>
  </select>
</td>
<td>
  <select class="config_sel" disabled>
    <option value="0">下拉</option>
  </select>
</td>
</tr>

<tr class="config_tr">
  <th>Pin16</th>
<td>
  <select class="config_sel">
  		<option value="0">----</option>
      <option value="3">信号输出</option>
  </select>
</td>
<td>
  <select class="config_sel">
    <option value="0">无</option>
  </select>
</td>
</tr>


</table>
</div>

<div class="btn_line">
<input type="submit" class="btn_ok" value="确定"></div>
</form>
<br>

<script type="text/javascript">
authHandler();
menuHandler();
txtHandler();
	
//保持uart选项一致
$(".has_uart").change(function(){	
	if($(this).val()==7)//有一个uart被选，就全选
	{
		$(".has_uart option").each(function(index,e){
			if(e.value==7) e.selected=true;
			else e.selected=false;					
		});
	}
	else//有一个uart被不选，就全不选
	{
		$(".has_uart option").each(function(index,e){
			if(e.value==7) e.selected=false;				
		});
	}
});
	
//保持oled选项一致
$(".has_oled").change(function(){	
	if($(this).val()==8)//有一个oled被选，就全选
	{
		$(".has_oled option").each(function(index,e){
			if(e.value==8) e.selected=true;
			else e.selected=false;					
		});
	}
	else//有一个oled被不选，就全不选
	{
		$(".has_oled option").each(function(index,e){
			if(e.value==8) e.selected=false;				
		});
	}
});	
		
//设置select name
$(".config_tr").each(function(i,e){		
	var Name=$(this).find("th").text().replace("Pin","");
	if(Name.length==1) Name="0"+Name;
		$(this).find("select").each(function(index,element){
	element.name="c"+Name+"_"+(index+1);	
  });			
});

//默认选项
$(".config_tr").each(function(i,e){		
	var Name=$(this).find("th").text().replace("Pin","");
	$(this).find("select").each(function(index,e){
		var OptsVal=getStrVal("${gpio_conf}","c"+Name);//c0=00&c4=00&c5=00&c12=11&c13=70&c14=10&c15=70&c16=00
		if(OptsVal!=null) //从数列中取值 
		{
			var Item=OptsVal.substr(index,1);
			if(Item>=0 && Item<10) Item=parseInt(Item);
			else Item=Item.charCodeAt(0)-97+10;//a=10,b=11....
			$(this).val(Item);
		}
	});			
});
</script>
</body>
</html>
<!--END-->